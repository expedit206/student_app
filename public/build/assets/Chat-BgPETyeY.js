import{d as k,j as m,q as f,g as n,o as l,b as s,F as b,r as w,i as C,t as d,l as D,v as E,B as T,D as U,E as j,h as g}from"./app-lorCX1eB.js";const B={class:"max-w-4xl mx-auto p-4 bg-white shadow-lg rounded-lg flex h-[600px]"},S={class:"w-1/3 border-r p-4 overflow-y-auto"},$=["onClick"],z={class:"w-2/3 p-4 flex flex-col"},M={class:"text-lg font-semibold mb-4"},A={key:0,class:"text-gray-500 text-center"},V={class:"p-2"},F={class:"font-bold"},K={class:"text-xs ml-2 opacity-75"},L={key:0,class:"flex gap-2"},O=k({__name:"Chat",props:{currentUser:Object,contacts:Array,friend:Object,messages:Array},setup(h){const t=h,r=m(t.friend),i=m(""),c=m(t.messages),u=m(null),x=async o=>{r.value=o;try{const a=await U.get("/chat/messages",{params:{sender_id:t.currentUser.id,sender_role:t.currentUser.role,receiver_id:o.id,receiver_role:o.role}});Echo.private(`chat.${t.currentUser.id}`).listen("MessageSend",v=>{c.value.push(v.message)}),c.value=a.data}catch(a){console.error("Erreur lors de la récupération des messages:",a),c.value=[]}};x(t.friend);const y=async()=>{if(!(!i.value.trim()||!r.value)){c.value.push({sender:t.currentUser.name,message:i.value,timestamp:new Date}),p();try{const o=await U.post("/chat/send",{message:i.value,receiver_id:r.value.id,receiver_role:r.value.role});i.value=""}catch(o){console.error("Erreur lors de l'envoi du message:",o)}}},p=()=>{j(()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)})};return f(c,()=>{p()}),f(r,()=>{p()}),(o,a)=>{var v;return l(),n("div",B,[s("div",S,[a[1]||(a[1]=s("h2",{class:"text-lg font-semibold mb-4"},"Contacts",-1)),s("ul",null,[(l(!0),n(b,null,w(h.contacts,e=>(l(),n("li",{key:`${e.role}-${e.id}`,onClick:_=>x(e),class:g(["p-2 mb-2 rounded cursor-pointer hover:bg-gray-100",{"bg-gray-200":r.value&&r.value.id===e.id}])},d(e.name)+" ("+d(e.role.charAt(0).toUpperCase()+e.role.slice(1))+") ",11,$))),128))])]),s("div",z,[s("h2",M,d((v=r.value)!=null&&v.name?`Discussion avec ${r.value.name}`:r.value?"Discussion avec l'admin":"Sélectionnez un contact"),1),s("div",{ref_key:"messagesContainer",ref:u,class:"flex-1 overflow-y-auto border p-4 mb-4 rounded"},[r.value?(l(!0),n(b,{key:1},w(c.value,(e,_)=>(l(),n("div",{key:_,class:g(["mb-2 flex",{"justify-end":e.sender===t.currentUser.name,"justify-start":e.sender!==t.currentUser.name}])},[s("div",{class:g(["max-w-xs",{"bg-indigo-500 text-white rounded-l-lg rounded-br-lg":e.sender===t.currentUser.name,"bg-gray-200 text-gray-800 rounded-r-lg rounded-bl-lg":e.sender!==t.currentUser.name}])},[s("div",V,[s("span",F,d(e.sender),1),s("span",K,d(new Date(e.timestamp).toLocaleTimeString()),1),s("p",null,d(e.message),1)])],2)],2))),128)):(l(),n("div",A," Sélectionnez un contact pour commencer une discussion. "))],512),r.value?(l(),n("div",L,[D(s("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),type:"text",placeholder:"Tapez votre message...",class:"flex-1 p-2 border rounded",onKeyup:T(y,["enter"])},null,544),[[E,i.value]]),s("button",{onClick:y,class:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700"}," Envoyer ")])):C("",!0)])])}}});export{O as default};
